# Open-nof1.ai æ¶æ„ä¸åŠŸèƒ½è¯´æ˜æ–‡æ¡£

> åŸºäºDeepSeek AIçš„åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿå®Œæ•´æ¶æ„åˆ†æ

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### ç°è±¡å±‚ï¼ˆç”¨æˆ·å¯è§ï¼‰
- **å®æ—¶äº¤æ˜“ä»ªè¡¨æ¿**ï¼šè´¦æˆ·æ€»å€¼ã€ç›ˆäºç»Ÿè®¡ã€åŠ å¯†è´§å¸ä»·æ ¼
- **AIå†³ç­–é€æ˜åº¦**ï¼šå®Œæ•´çš„æ€ç»´é“¾å’Œæ¨ç†è¿‡ç¨‹å±•ç¤º
- **äº¤æ˜“å†å²**ï¼šä¹°å…¥/å–å‡ºè®°å½•ã€æŒä»“ä¿¡æ¯
- **å®æ—¶æ•°æ®æµ**ï¼šæ¯10ç§’è‡ªåŠ¨æ›´æ–°çš„å¸‚åœºæ•°æ®

### æœ¬è´¨å±‚ï¼ˆç³»ç»Ÿè®¾è®¡ï¼‰
- **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œæ¥å£å®šä¹‰
- **äº‹ä»¶é©±åŠ¨**ï¼šå®šæ—¶ä»»åŠ¡è§¦å‘æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- **æ•°æ®å®Œæ•´æ€§**ï¼šå®Œæ•´çš„AIå†³ç­–è¿‡ç¨‹è®°å½•
- **å®‰å…¨è®¤è¯**ï¼šJWTä¿æŠ¤çš„å…³é”®APIç«¯ç‚¹

### å“²å­¦å±‚ï¼ˆè®¾è®¡ç†å¿µï¼‰
- **"ä¿¡ä»»ä½†è¦éªŒè¯"**ï¼šæ¯ä¸ªAIå†³ç­–éƒ½æœ‰å®Œæ•´çš„æ¨ç†è¿‡ç¨‹è®°å½•
- **"å®æ—¶æ€§å³çœŸå®æ€§"**ï¼šåœ¨çœŸå®å¸‚åœºä¸­æµ‹è¯•AIèƒ½åŠ›
- **"é€æ˜åº¦å»ºç«‹ä¿¡ä»»"**ï¼šæ‰€æœ‰å†³ç­–è¿‡ç¨‹å¯è¿½æº¯å’Œå®¡è®¡
- **"ç®€å•å³å¼ºå¤§"**ï¼šç”¨æœ€ç®€æ´çš„æ¶æ„è§£å†³å¤æ‚é—®é¢˜

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚ Frontend Layer"
        A[Dashboard UI] --> B[å®æ—¶å›¾è¡¨]
        A --> C[äº¤æ˜“å†å²]
        A --> D[AIæ€ç»´é“¾]
        A --> E[åŠ å¯†è´§å¸ä»·æ ¼]
    end
    
    subgraph "APIå±‚ API Layer"
        F[Next.js App Router] --> G[å®šæ—¶ä»»åŠ¡API]
        F --> H[æŒ‡æ ‡æ”¶é›†API]
        F --> I[å®šä»·API]
        F --> J[èŠå¤©å†å²API]
    end
    
    subgraph "AIå†³ç­–å±‚ AI Decision Layer"
        K[DeepSeek R1æ¨¡å‹] --> L[æç¤ºå·¥ç¨‹]
        K --> M[å¸‚åœºåˆ†æå·¥å…·]
        K --> N[äº¤æ˜“å†³ç­–ç”Ÿæˆ]
        K --> O[æ€ç»´é“¾è®°å½•]
    end
    
    subgraph "äº¤æ˜“æ‰§è¡Œå±‚ Trading Layer"
        P[CCXT Binance] --> Q[æŠ€æœ¯æŒ‡æ ‡è®¡ç®—]
        P --> R[è´¦æˆ·ä¿¡æ¯è·å–]
        P --> S[å¸‚åœºçŠ¶æ€åˆ†æ]
        P --> T[æŒä»“ç®¡ç†]
    end
    
    subgraph "æ•°æ®å±‚ Data Layer"
        U[PostgreSQL] --> V[æŒ‡æ ‡æ•°æ®]
        U --> W[èŠå¤©è®°å½•]
        U --> X[äº¤æ˜“å†å²]
    end
    
    subgraph "å®šæ—¶ä»»åŠ¡ Cron Jobs"
        Y[20ç§’æŒ‡æ ‡æ”¶é›†] --> V
        Z[3åˆ†é’ŸAIå†³ç­–] --> K
    end
    
    G --> Z
    G --> Y
    L --> K
    M --> K
    N --> P
    O --> W
    R --> V
    S --> M
    V --> B
    W --> D
    X --> C
```

## ğŸ§  æ ¸å¿ƒåŠŸèƒ½æ¨¡å—å·¥ä½œåŸç†

### 1. AIå†³ç­–æ¨¡å— (`lib/ai/`)

#### æ¨¡å‹é…ç½® (`model.ts`)
```typescript
// æ”¯æŒçš„AIæ¨¡å‹
- DeepSeek V3.2: ä¸»è¦äº¤æ˜“æ¨¡å‹
- DeepSeek R1: æ¨ç†æ¨¡å‹ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
- OpenRouter: å¤šæ¨¡å‹æ”¯æŒç½‘å…³
```

#### æç¤ºå·¥ç¨‹ (`prompt.ts`)
**æ ¸å¿ƒè®¾è®¡ç†å¿µ**ï¼šè®©AIæ‰®æ¼”ä¸“ä¸šåŠ å¯†è´§å¸åˆ†æå¸ˆè§’è‰²

**ç³»ç»Ÿæç¤ºç»“æ„**ï¼š
- è§’è‰²å®šä¹‰ï¼šä¸“ä¸šåŠ å¯†è´§å¸åˆ†æå¸ˆå’Œäº¤æ˜“å‘˜
- åˆ†ææ¡†æ¶ï¼šæŠ€æœ¯æŒ‡æ ‡ã€å¸‚åœºåŠ¨æ€ã€é£é™©è¯„ä¼°
- å†³ç­–æ ¼å¼ï¼šæ˜ç¡®çš„BUY/SELL/HOLDæ¨è
- é£é™©ç®¡ç†ï¼šæ­¢æŸæ­¢ç›ˆã€ä»“ä½å¤§å°å»ºè®®

**ç”¨æˆ·æç¤ºç”Ÿæˆ**ï¼š
```typescript
function generateUserPrompt(options: {
  currentMarketState: MarketState,
  accountInformationAndPerformance: AccountInfo,
  startTime: Date,
  invocationCount: number
}): string
```

#### AIæ‰§è¡Œé€»è¾‘ (`run.ts`)
**å†³ç­–æµç¨‹**ï¼š
1. **æ•°æ®å‡†å¤‡**ï¼šè·å–å¸‚åœºçŠ¶æ€å’Œè´¦æˆ·ä¿¡æ¯
2. **æç¤ºç”Ÿæˆ**ï¼šç»„åˆç³»ç»Ÿæç¤ºå’Œç”¨æˆ·æç¤º
3. **AIè°ƒç”¨**ï¼šä½¿ç”¨DeepSeek R1ç”Ÿæˆç»“æ„åŒ–å†³ç­–
4. **ç»“æœè§£æ**ï¼šéªŒè¯å¹¶æå–äº¤æ˜“å‚æ•°
5. **æ•°æ®å­˜å‚¨**ï¼šè®°å½•å®Œæ•´çš„æ€ç»´é“¾å’Œå†³ç­–

**å†³ç­–è¾“å‡ºç»“æ„**ï¼š
```typescript
{
  opeartion: "Buy" | "Sell" | "Hold",
  buy?: { pricing: number, amount: number, leverage: number },
  sell?: { percentage: number },
  adjustProfit?: { stopLoss?: number, takeProfit?: number },
  chat: string // å†³ç­–ç†ç”±å’Œåˆ†æ
}
```

### 2. äº¤æ˜“æ‰§è¡Œæ¨¡å— (`lib/trading/`)

#### å¸‚åœºçŠ¶æ€åˆ†æ (`current-market-state.ts`)
**æŠ€æœ¯æŒ‡æ ‡è®¡ç®—**ï¼š
- **EMA** (Exponential Moving Average)ï¼šè¶‹åŠ¿æ–¹å‘
- **MACD** (Moving Average Convergence Divergence)ï¼šåŠ¨é‡æŒ‡æ ‡
- **RSI** (Relative Strength Index)ï¼šè¶…ä¹°è¶…å–
- **ATR** (Average True Range)ï¼šæ³¢åŠ¨æ€§

**æ•°æ®æº**ï¼š
- 1åˆ†é’ŸKçº¿æ•°æ®ï¼šçŸ­æœŸæŠ€æœ¯åˆ†æ
- 4å°æ—¶Kçº¿æ•°æ®ï¼šé•¿æœŸè¶‹åŠ¿åˆ†æ
- æŒä»“é‡å’Œèµ„é‡‘è´¹ç‡ï¼šå¸‚åœºæƒ…ç»ª

#### è´¦æˆ·ä¿¡æ¯ç®¡ç† (`account-information-and-performance.ts`)
**å…³é”®æŒ‡æ ‡**ï¼š
- `currentPositionsValue`ï¼šå½“å‰æŒä»“ä»·å€¼
- `totalCashValue`ï¼šæ€»ç°é‡‘ä»·å€¼
- `currentTotalReturn`ï¼šæ€»æ”¶ç›Šç‡
- `sharpeRatio`ï¼šå¤æ™®æ¯”ç‡
- `availableCash`ï¼šå¯ç”¨ç°é‡‘

### 3. APIè·¯ç”±å’Œå®šæ—¶ä»»åŠ¡ (`app/api/`)

#### 3åˆ†é’Ÿäº¤æ˜“å†³ç­– (`cron/3-minutes-run-interval/route.ts`)
**å·¥ä½œæµç¨‹**ï¼š
1. **è®¤è¯éªŒè¯**ï¼šJWT TokenéªŒè¯
2. **AIå†³ç­–æ‰§è¡Œ**ï¼šè°ƒç”¨ `lib/ai/run.ts`
3. **ç»“æœå­˜å‚¨**ï¼šä¿å­˜åˆ°Chatå’ŒTradingè¡¨
4. **å“åº”è¿”å›**ï¼šæ‰§è¡ŒçŠ¶æ€ç¡®è®¤

#### 20ç§’æŒ‡æ ‡æ”¶é›† (`cron/20-seconds-metrics-interval/route.ts`)
**æ•°æ®ç®¡ç†ç­–ç•¥**ï¼š
- **æœ€å¤§æ•°æ®ç‚¹**ï¼š100ä¸ªï¼ˆé˜²æ­¢æ•°æ®åº“è†¨èƒ€ï¼‰
- **å‡åŒ€é‡‡æ ·**ï¼šä¿æŒæ•°æ®åˆ†å¸ƒå®Œæ•´æ€§
- **è¾¹ç•Œä¿æŠ¤**ï¼šä¿ç•™é¦–å°¾æ•°æ®ç‚¹

**é‡‡æ ·ç®—æ³•**ï¼š
```typescript
function uniformSampleWithBoundaries<T>(data: T[], maxSize: number): T[] {
  if (data.length <= maxSize) return data;
  
  const result: T[] = [];
  const step = (data.length - 1) / (maxSize - 1);
  
  for (let i = 0; i < maxSize; i++) {
    const index = Math.round(i * step);
    result.push(data[index]);
  }
  
  return result;
}
```

#### æŒ‡æ ‡æŸ¥è¯¢API (`metrics/route.ts`)
**æ•°æ®ä¼˜åŒ–**ï¼š
- å‰ç«¯æœ€å¤šæ˜¾ç¤º50ä¸ªæ•°æ®ç‚¹
- å‡åŒ€é‡‡æ ·ç¡®ä¿å›¾è¡¨æµç•…æ€§
- é”™è¯¯å¤„ç†ä¿è¯æœåŠ¡å¯ç”¨æ€§

### 4. å‰ç«¯æ•°æ®æµ (`app/page.tsx` + `components/`)

#### å®æ—¶æ•°æ®æ›´æ–°æœºåˆ¶
```typescript
// æ¯10ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
useEffect(() => {
  fetchMetrics();
  fetchPricing();
  
  const metricsInterval = setInterval(fetchMetrics, 10000);
  const pricingInterval = setInterval(fetchPricing, 10000);
  
  return () => {
    clearInterval(metricsInterval);
    clearInterval(pricingInterval);
  };
}, [fetchMetrics, fetchPricing]);
```

#### ç»„ä»¶æ¶æ„
- **MetricsChart**ï¼šè´¦æˆ·æ€»å€¼è¶‹åŠ¿å›¾ï¼Œå¸¦DeepSeekå“ç‰ŒåŠ¨ç”»
- **ModelsView**ï¼šAIå†³ç­–å†å²ï¼Œæ”¯æŒå±•å¼€/æ”¶èµ·
- **CryptoCard**ï¼šåŠ å¯†è´§å¸ä»·æ ¼å¡ç‰‡
- **UIç»„ä»¶**ï¼šåŸºäºshadcn/uiçš„ç»Ÿä¸€è®¾è®¡ç³»ç»Ÿ

## ğŸ”„ æ ¸å¿ƒå·¥ä½œæµç¨‹

### å®šæ—¶ä»»åŠ¡æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤–éƒ¨CronæœåŠ¡   â”‚ -> â”‚  APIè®¤è¯éªŒè¯     â”‚ -> â”‚  ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                       â†“                       â†“
   å®šæ—¶è§¦å‘è¯·æ±‚              JWT TokenéªŒè¯           AIå†³ç­–/æ•°æ®æ”¶é›†
```

### AIå†³ç­–å®Œæ•´æµç¨‹

```
å¸‚åœºæ•°æ®æ”¶é›† â†’ æŠ€æœ¯æŒ‡æ ‡è®¡ç®— â†’ AIåˆ†ææ¨ç† â†’ äº¤æ˜“å†³ç­–ç”Ÿæˆ â†’ ç»“æœè®°å½•å­˜å‚¨
     â†“              â†“              â†“              â†“              â†“
 ä»·æ ¼/æŒä»“é‡      EMA/MACD/RSI   æ€ç»´é“¾ç”Ÿæˆ     BUY/SELL/HOLD   æ•°æ®åº“æŒä¹…åŒ–
```

### å‰ç«¯æ•°æ®å±•ç¤ºæµç¨‹

```
APIæ•°æ®è·å– â†’ æ•°æ®å¤„ç†ä¼˜åŒ– â†’ ç»„ä»¶çŠ¶æ€æ›´æ–° â†’ ç”¨æˆ·ç•Œé¢æ¸²æŸ“ â†’ å®šæ—¶åˆ·æ–°
     â†“             â†“             â†“             â†“             â†“
 æŒ‡æ ‡/ä»·æ ¼       å‡åŒ€é‡‡æ ·       ReactçŠ¶æ€     å›¾è¡¨/å¡ç‰‡      10ç§’é—´éš”
```

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### Metrics è¡¨ - æŒ‡æ ‡æ—¶é—´åºåˆ—
```prisma
model Metrics {
  id        String   @id @default(uuid())
  name      String   // "20-seconds-metrics"
  model     ModelType // Deepseek
  metrics   Json[]   // æŒ‡æ ‡æ•°æ®æ•°ç»„
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### Chat è¡¨ - AIå†³ç­–è®°å½•
```prisma
model Chat {
  id         String    @id @default(uuid())
  model      ModelType @default(Deepseek)
  chat       String    @default("<no chat>")
  reasoning  String    // AIæ¨ç†è¿‡ç¨‹
  userPrompt String    // ç”¨æˆ·æç¤º
  tradings   Trading[] // å…³è”äº¤æ˜“è®°å½•
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}
```

### Trading è¡¨ - äº¤æ˜“æ“ä½œ
```prisma
model Trading {
  id        String     @id @default(uuid())
  symbol    Symbol     // BTC/ETH/SOL/BNB/DOGE
  opeartion Opeartion  // Buy/Sell/Hold
  leverage  Int?       // æ æ†å€æ•° (1-20x)
  amount    Int?       // äº¤æ˜“æ•°é‡
  pricing   Int?       // äº¤æ˜“ä»·æ ¼
  stopLoss  Int?       // æ­¢æŸä»·æ ¼
  takeProfit Int?      // æ­¢ç›ˆä»·æ ¼
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  
  Chat   Chat?   @relation(fields: [chatId], references: [id])
  chatId String? // å…³è”èŠå¤©è®°å½•
}
```

## ğŸ› ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### æ•°æ®é‡‡æ ·ç®—æ³•
- **å‡åŒ€é‡‡æ ·**ï¼šä¿æŒæ•°æ®åˆ†å¸ƒç‰¹å¾
- **è¾¹ç•Œä¿æŠ¤**ï¼šç¡®ä¿é¦–å°¾æ•°æ®ç‚¹å®Œæ•´
- **å†…å­˜æ§åˆ¶**ï¼šé˜²æ­¢æ•°æ®åº“è¿‡åº¦å¢é•¿

#### å‰ç«¯æ¸²æŸ“ä¼˜åŒ–
- **è™šæ‹Ÿæ»šåŠ¨**ï¼šé•¿åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–
- **å›¾ç‰‡æ‡’åŠ è½½**ï¼šå‡å°‘åˆå§‹åŠ è½½æ—¶é—´
- **çŠ¶æ€è®°å¿†**ï¼šé¿å…ä¸å¿…è¦é‡æ¸²æŸ“

### é”™è¯¯å¤„ç†æœºåˆ¶

#### APIé”™è¯¯å¤„ç†
```typescript
try {
  // ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
} catch (error) {
  console.error("Error executing task:", error);
  return new Response("Process execution failed", { status: 500 });
}
```

#### æ•°æ®éªŒè¯
- JWT TokenéªŒè¯
- å‚æ•°ç±»å‹æ£€æŸ¥
- æ•°æ®åº“æ“ä½œå¼‚å¸¸å¤„ç†

### å®‰å…¨è€ƒè™‘

#### APIä¿æŠ¤
- å®šæ—¶ä»»åŠ¡éœ€è¦Bearer Tokenè®¤è¯
- æ•æ„Ÿæ“ä½œæ—¥å¿—è®°å½•
- æ•°æ®åº“è¿æ¥æ± ç®¡ç†

#### æ•°æ®å®‰å…¨
- ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²åŠ å¯†
- APIå¯†é’¥å®‰å…¨å­˜å‚¨

## ğŸ¯ ç³»ç»Ÿç‰¹è‰²

### 1. å®Œå…¨é€æ˜çš„AIå†³ç­–
- æ¯ä¸ªå†³ç­–éƒ½æœ‰å®Œæ•´çš„æ€ç»´é“¾è®°å½•
- ç”¨æˆ·å¯ä»¥æŸ¥çœ‹AIçš„å®Œæ•´æ¨ç†è¿‡ç¨‹
- æ‰€æœ‰äº¤æ˜“å‚æ•°å’Œç†ç”±æ¸…æ™°å¯è§

### 2. å®æ—¶å¸‚åœºé›†æˆ
- ç›´æ¥è¿æ¥Binanceäº¤æ˜“æ‰€
- å®æ—¶æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
- è‡ªåŠ¨åŒ–çš„å®šæ—¶å†³ç­–æ‰§è¡Œ

### 3. ä¼˜é›…çš„ç”¨æˆ·ä½“éªŒ
- åŸºäºshadcn/uiçš„ç°ä»£åŒ–ç•Œé¢
- å®æ—¶æ•°æ®è‡ªåŠ¨æ›´æ–°
- å“åº”å¼è®¾è®¡æ”¯æŒå¤šè®¾å¤‡

### 4. å¯æ‰©å±•çš„æ¶æ„
- æ¨¡å—åŒ–è®¾è®¡ä¾¿äºåŠŸèƒ½æ‰©å±•
- æ”¯æŒå¤šAIæ¨¡å‹åˆ‡æ¢
- çµæ´»çš„æ•°æ®é‡‡æ ·ç­–ç•¥

## ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘

### çŸ­æœŸæ”¹è¿›
- [ ] å®ç°å®é™…çš„äº¤æ˜“æ‰§è¡ŒåŠŸèƒ½ï¼ˆå½“å‰buy/sellä¸ºç©ºå‡½æ•°ï¼‰
- [ ] æ·»åŠ æ›´å¤šæŠ€æœ¯æŒ‡æ ‡å’Œåˆ†æå·¥å…·
- [ ] ä¼˜åŒ–AIæç¤ºå·¥ç¨‹å’Œå†³ç­–è´¨é‡

### é•¿æœŸè§„åˆ’
- [ ] æ”¯æŒå¤šäº¤æ˜“æ‰€é›†æˆ
- [ ] å®ç°å›æµ‹å’Œç­–ç•¥ä¼˜åŒ–
- [ ] æ·»åŠ é£é™©ç®¡ç†æ¨¡å—
- [ ] æ”¯æŒè‡ªå®šä¹‰äº¤æ˜“ç­–ç•¥

---

**âš¡ åŸºäºçœŸå®å¸‚åœºçš„AIæ™ºèƒ½å†³ç­–ç³»ç»Ÿ**

*"è®©AIåœ¨çœŸå®é‡‘èå¸‚åœºä¸­è¯æ˜è‡ªå·±çš„ä»·å€¼ï¼Œæ¯ä¸ªå†³ç­–éƒ½æœ‰å®Œæ•´çš„æ€ç»´é“¾è®°å½•ã€‚"*